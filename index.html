<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QueueSmart</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root {
      --bg-main: #020617;
      --bg-accent: #0f172a;
      --glass-bg: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.12);
      --blue-main: #2563eb;
      --blue-glow: #38bdf8;
      --green-main: #22c55e;
      --green-glow: #86efac;
      --red-main: #ef4444;
      --red-glow: #fca5a5;
      --text-main: #e5e7eb;
      --text-muted: rgba(229,231,235,0.65);
      --shadow-glass: 0 30px 60px rgba(0,0,0,0.55);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, var(--bg-accent), var(--bg-main));
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 450px;
      padding: 28px;
      border-radius: 20px;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-glass);
    }

    h1 {
      font-size: 26px;
      font-weight: 700;
      text-align: center;
      letter-spacing: 0.4px;
      margin-bottom: 8px;
    }

    .subtitle {
      text-align: center;
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 22px;
    }

    button {
      width: 100%;
      padding: 14px;
      margin-top: 12px;
      border-radius: 12px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, var(--blue-main), var(--blue-glow));
      color: white;
      transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s ease;
      box-shadow: 0 0 0 rgba(56,189,248,0);
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(56,189,248,0.35);
      opacity: 0.95;
    }

    button.ghost {
      background: transparent;
      border: 1px solid var(--glass-border);
      box-shadow: none;
    }

    input, select {
      width: 100%;
      padding: 13px;
      margin-top: 12px;
      border-radius: 10px;
      border: 1px solid var(--glass-border);
      background: rgba(255,255,255,0.07);
      color: white;
      outline: none;
      font-size: 14px;
    }

    select option {
      color: black;
    }

    .hidden {
      display: none !important;
    }

    .center {
      text-align: center;
    }

    .divider {
      height: 1px;
      background: var(--glass-border);
      margin: 18px 0;
    }

    .mode-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.12);
      font-size: 13px;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>

<div class="app">

  <!-- ================= LOGIN SCREEN ================= -->
  <section id="screen-login">
    <div class="center">
      <div class="mode-pill">
        <i data-lucide="shield"></i> Secure Gateway
      </div>
      <h1>QueueSmart</h1>
      <p class="subtitle">Smart Queue & Capacity Control</p>
    </div>

    <button id="btn-google-login">
      <i data-lucide="log-in"></i> Sign in with Google
    </button>

    <div class="divider"></div>

    <button id="btn-toggle-admin" class="ghost">
      <i data-lucide="key"></i> Switch to GOD Mode
    </button>
  </section>

  <!-- ================= PROFILE SETUP ================= -->
  <section id="screen-setup" class="hidden">
    <h1>Create Profile</h1>
    <p class="subtitle">One-time setup</p>

    <input id="setup-name" placeholder="Full Name" />
    <input id="setup-age" type="number" placeholder="Age" />

    <select id="setup-gender">
      <option value="">Select Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Other">Other</option>
    </select>

    <button id="btn-save-profile">
      <i data-lucide="save"></i> Save Profile
    </button>
  </section>

</div>

<script>
  lucide.createIcons();
</script>

</body>
</html>
<!-- ================= LOCATION LIST ================= -->
<section id="screen-locations" class="hidden">
  <h1>Locations</h1>
  <p class="subtitle">Select where you want to check in</p>

  <input id="location-search" placeholder="Search location..." />

  <div id="location-list" style="margin-top:12px;">
    <!-- Locations will be dynamically inserted here -->
  </div>

  <button id="btn-logout" class="ghost">
    <i data-lucide="log-out"></i> Logout
  </button>
</section>

<!-- ================= USER DASHBOARD ================= -->
<section id="screen-user-dashboard" class="hidden">
  <h1 id="user-location-name">Location</h1>
  <p class="subtitle">Live Queue Status</p>

  <div class="user-box" style="margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.06); border-radius: 14px;">
    <div style="font-size: 48px; font-weight: 700;" id="user-current-count">0</div>
    <div class="subtitle">People Waiting</div>
  </div>

  <button id="btn-join-queue" style="margin-top: 20px;">
    <i data-lucide="plus-circle"></i> Join Queue
  </button>

  <button id="btn-leave-queue" class="ghost">
    <i data-lucide="x-circle"></i> Leave Queue
  </button>

  <button id="btn-back-locations" class="ghost">
    ← Back
  </button>
</section>

<style>
  #location-list {
    max-height: 220px;
    overflow-y: auto;
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 8px;
    background: rgba(255,255,255,0.05);
  }

  .location-item {
    padding: 10px 12px;
    margin-bottom: 6px;
    border-radius: 10px;
    background: rgba(255,255,255,0.08);
    cursor: pointer;
    transition: background 0.15s ease, transform 0.15s ease;
  }

  .location-item:hover {
    background: rgba(56,189,248,0.2);
    transform: translateX(4px);
  }

  /* Scrollbar */
  #location-list::-webkit-scrollbar {
    width: 6px;
  }
  #location-list::-webkit-scrollbar-thumb {
    background: rgba(56,189,248,0.3);
    border-radius: 3px;
  }

  .user-box {
    text-align: center;
    transition: all 0.2s ease;
  }

  #btn-join-queue {
    background: linear-gradient(135deg, var(--green-main), var(--green-glow));
  }

  #btn-leave-queue {
    background: linear-gradient(135deg, var(--red-main), var(--red-glow));
  }
</style>

<script>
  // Dummy locations for demo
  const locations = ["Main Lobby", "Cafeteria", "Gym Hall", "Library", "Auditorium"];

  const locationListEl = document.getElementById("location-list");
  const locationSearchEl = document.getElementById("location-search");

  function renderLocations(filter="") {
    locationListEl.innerHTML = "";
    locations
      .filter(loc => loc.toLowerCase().includes(filter.toLowerCase()))
      .forEach(loc => {
        const div = document.createElement("div");
        div.classList.add("location-item");
        div.textContent = loc;
        div.onclick = () => {
          document.getElementById("screen-locations").classList.add("hidden");
          document.getElementById("screen-user-dashboard").classList.remove("hidden");
          document.getElementById("user-location-name").textContent = loc;
        };
        locationListEl.appendChild(div);
      });
  }

  locationSearchEl.addEventListener("input", (e) => {
    renderLocations(e.target.value);
  });

  renderLocations();
</script>
<!-- ================= GOD DASHBOARD ================= -->
<section id="screen-god-dashboard" class="hidden">
  <h1 id="god-location-name">Admin Panel</h1>
  <p class="subtitle">Live Queue Control</p>

  <div id="god-queue-list" style="margin-top:16px;">
    <!-- Queue items will appear here -->
  </div>

  <div class="divider"></div>

  <button id="btn-create-location">
    <i data-lucide="map-pin-plus"></i> Create Location
  </button>

  <button id="btn-view-logs" class="ghost">
    <i data-lucide="activity"></i> View Logs
  </button>

  <button id="btn-god-back" class="ghost">
    ← Back
  </button>
</section>

<!-- ================= LOG VIEW ================= -->
<section id="screen-logs" class="hidden">
  <h1>Activity Logs</h1>
  <p class="subtitle">Admin actions & user events</p>

  <div id="logs-list" style="margin-top:12px; max-height: 300px; overflow-y:auto; border:1px solid var(--glass-border); border-radius:12px; padding:10px; background: rgba(255,255,255,0.05);">
    <!-- Logs dynamically inserted -->
  </div>

  <button id="btn-logs-back" class="ghost">
    ← Back
  </button>
</section>

<style>
  #god-queue-list {
    max-height: 240px;
    overflow-y: auto;
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 8px;
    background: rgba(255,255,255,0.05);
  }

  .queue-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    margin-bottom: 6px;
    border-radius: 10px;
    background: rgba(255,255,255,0.08);
    transition: all 0.15s ease;
  }

  .queue-item:hover {
    background: rgba(56,189,248,0.2);
    transform: translateX(3px);
  }

  .log-entry {
    padding: 6px 8px;
    margin-bottom: 4px;
    border-radius: 8px;
    background: rgba(255,255,255,0.07);
    font-size: 13px;
  }

  #logs-list::-webkit-scrollbar, #god-queue-list::-webkit-scrollbar {
    width: 6px;
  }

  #logs-list::-webkit-scrollbar-thumb, #god-queue-list::-webkit-scrollbar-thumb {
    background: rgba(56,189,248,0.3);
    border-radius: 3px;
  }
</style>

<script>
  const godQueueListEl = document.getElementById("god-queue-list");
  const logsListEl = document.getElementById("logs-list");

  // Dummy queue and logs
  let queueData = [
    { name: "Alice", joined: "10:02 AM" },
    { name: "Bob", joined: "10:05 AM" },
    { name: "Charlie", joined: "10:12 AM" },
  ];

  let logsData = [
    "Alice joined Cafeteria at 10:02 AM",
    "Bob joined Gym Hall at 10:05 AM",
    "Charlie joined Library at 10:12 AM"
  ];

  function renderQueue() {
    godQueueListEl.innerHTML = "";
    queueData.forEach((user, idx) => {
      const div = document.createElement("div");
      div.classList.add("queue-item");
      div.innerHTML = `
        <span>${user.name}</span>
        <span>${user.joined}</span>
        <button style="background:#ef4444; color:white; border:none; padding:4px 8px; border-radius:6px; cursor:pointer;">Remove</button>
      `;
      div.querySelector("button").onclick = () => {
        queueData.splice(idx,1);
        logsData.push(`${user.name} was removed by Admin`);
        renderQueue();
        renderLogs();
      };
      godQueueListEl.appendChild(div);
    });
  }

  function renderLogs() {
    logsListEl.innerHTML = "";
    logsData.slice().reverse().forEach(entry => {
      const div = document.createElement("div");
      div.classList.add("log-entry");
      div.textContent = entry;
      logsListEl.appendChild(div);
    });
  }

  renderQueue();
  renderLogs();
</script>
<!-- ================= CREATE LOCATION FORM ================= -->
<section id="screen-create-location" class="hidden">
  <h1>Create Location</h1>
  <p class="subtitle">Add a new location to manage queues</p>

  <input id="new-location-name" placeholder="Location Name" />
  <input id="new-location-capacity" type="number" placeholder="Max Capacity" />

  <button id="btn-save-location">
    <i data-lucide="plus-square"></i> Save Location
  </button>

  <button id="btn-cancel-location" class="ghost">
    ← Cancel
  </button>
</section>

<!-- ================= USER PROFILE SETUP ================= -->
<section id="screen-setup-profile" class="hidden">
  <h1>Setup Profile</h1>
  <p class="subtitle">Complete your profile before joining queues</p>

  <input id="profile-name" placeholder="Full Name" />
  <input id="profile-age" type="number" placeholder="Age" />

  <select id="profile-gender">
    <option value="">Select Gender</option>
    <option value="Male">Male</option>
    <option value="Female">Female</option>
    <option value="Other">Other</option>
  </select>

  <button id="btn-save-profile">
    <i data-lucide="save"></i> Save Profile
  </button>
</section>

<style>
  #screen-create-location, #screen-setup-profile {
    padding-top: 8px;
  }

  input {
    transition: all 0.2s ease;
  }

  input:focus {
    border-color: var(--blue-glow);
    box-shadow: 0 0 8px rgba(56,189,248,0.3);
  }

  button:active {
    transform: translateY(1px);
    box-shadow: 0 4px 8px rgba(56,189,248,0.25);
  }
</style>

<script>
  const btnCreateLocation = document.getElementById("btn-create-location");
  const btnCancelLocation = document.getElementById("btn-cancel-location");
  const screenCreateLocation = document.getElementById("screen-create-location");
  const screenGodDashboard = document.getElementById("screen-god-dashboard");

  btnCreateLocation.onclick = () => {
    screenGodDashboard.classList.add("hidden");
    screenCreateLocation.classList.remove("hidden");
  };

  btnCancelLocation.onclick = () => {
    screenCreateLocation.classList.add("hidden");
    screenGodDashboard.classList.remove("hidden");
  };

  const btnSaveLocation = document.getElementById("btn-save-location");
  const newLocationName = document.getElementById("new-location-name");
  const newLocationCapacity = document.getElementById("new-location-capacity");

  let locations = [];

  btnSaveLocation.onclick = () => {
    const name = newLocationName.value.trim();
    const capacity = parseInt(newLocationCapacity.value);
    if (!name || !capacity) {
      alert("Please enter valid name and capacity.");
      return;
    }
    locations.push({ name, capacity, current: 0 });
    logsData.push(`Location "${name}" created with capacity ${capacity}`);
    renderLogs();
    newLocationName.value = "";
    newLocationCapacity.value = "";
    screenCreateLocation.classList.add("hidden");
    screenGodDashboard.classList.remove("hidden");
    renderQueue();
  };

  // ================= USER DASHBOARD JOIN/LEAVE =================
  const btnJoinQueue = document.getElementById("btn-join-queue");
  const btnLeaveQueue = document.getElementById("btn-leave-queue");
  const userCurrentCountEl = document.getElementById("user-current-count");

  let userInQueue = false;

  btnJoinQueue.onclick = () => {
    if (userInQueue) {
      alert("Already in queue!");
      return;
    }
    userInQueue = true;
    userCurrentCountEl.textContent = parseInt(userCurrentCountEl.textContent) + 1;
    logsData.push("User joined the queue");
    renderLogs();
  };

  btnLeaveQueue.onclick = () => {
    if (!userInQueue) {
      alert("You are not in queue!");
      return;
    }
    userInQueue = false;
    userCurrentCountEl.textContent = Math.max(0, parseInt(userCurrentCountEl.textContent) - 1);
    logsData.push("User left the queue");
    renderLogs();
  };
</script>
<!-- ================= LOCATION SELECTION ================= -->
<script>
  const locationSearch = document.getElementById("location-search");
  const locationList = document.getElementById("location-list");
  const screenLocations = document.getElementById("screen-locations");
  const screenUserDashboard = document.getElementById("screen-user-dashboard");
  const userLocationName = document.getElementById("user-location-name");

  // Sample locations (will be dynamically updated later)
  if (!locations.length) {
    locations = [
      { name: "Main Lobby", capacity: 20, current: 0 },
      { name: "Conference Hall", capacity: 15, current: 0 },
      { name: "Cafeteria", capacity: 10, current: 0 },
    ];
  }

  function renderLocations(filter = "") {
    locationList.innerHTML = "";
    const filtered = locations.filter(loc => loc.name.toLowerCase().includes(filter.toLowerCase()));
    filtered.forEach((loc, index) => {
      const div = document.createElement("div");
      div.classList.add("user-box");
      div.style.cursor = "pointer";
      div.innerHTML = `
        <strong>${loc.name}</strong><br>
        ${loc.current}/${loc.capacity} people waiting
      `;
      div.onclick = () => selectLocation(index);
      locationList.appendChild(div);
    });
  }

  function selectLocation(index) {
    const loc = locations[index];
    userLocationName.textContent = loc.name;
    userCurrentCountEl.textContent = loc.current;
    screenLocations.classList.add("hidden");
    screenUserDashboard.classList.remove("hidden");
    logsData.push(`User selected location "${loc.name}"`);
    renderLogs();
  }

  locationSearch.addEventListener("input", () => {
    renderLocations(locationSearch.value);
  });

  renderLocations();

  // Back button
  document.getElementById("btn-back-locations").onclick = () => {
    screenUserDashboard.classList.add("hidden");
    screenLocations.classList.remove("hidden");
  };

  // Logout button
  document.getElementById("btn-logout").onclick = () => {
    alert("Logging out (demo)");
    location.reload();
  };

  // Update queue count dynamically (example animation)
  function updateQueueCount(index, delta) {
    locations[index].current = Math.max(0, locations[index].current + delta);
    if (userLocationName.textContent === locations[index].name) {
      let el = userCurrentCountEl;
      el.style.transition = "transform 0.3s ease";
      el.style.transform = "scale(1.4)";
      setTimeout(() => { el.style.transform = "scale(1)"; }, 300);
      el.textContent = locations[index].current;
    }
    renderLocations(locationSearch.value);
  }

  // Example usage: when user joins/leaves queue
  btnJoinQueue.onclick = () => {
    if (userInQueue) { alert("Already in queue!"); return; }
    userInQueue = true;
    const index = locations.findIndex(loc => loc.name === userLocationName.textContent);
    updateQueueCount(index, 1);
    logsData.push(`User joined queue at "${userLocationName.textContent}"`);
    renderLogs();
  };

  btnLeaveQueue.onclick = () => {
    if (!userInQueue) { alert("Not in queue!"); return; }
    userInQueue = false;
    const index = locations.findIndex(loc => loc.name === userLocationName.textContent);
    updateQueueCount(index, -1);
    logsData.push(`User left queue at "${userLocationName.textContent}"`);
    renderLogs();
  };
</script>

<style>
  #location-list .user-box {
    margin-top: 10px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  #location-list .user-box:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(56,189,248,0.25);
  }
</style>
<!-- ================= GOD MODE DASHBOARD ================= -->
<script>
  const screenGodDashboard = document.getElementById("screen-god-dashboard");
  const godQueueList = document.getElementById("god-queue-list");
  const btnGodBack = document.getElementById("btn-god-back");
  const btnCreateLocation = document.getElementById("btn-create-location");
  const btnViewLogs = document.getElementById("btn-view-logs");
  const screenLogs = document.getElementById("screen-logs");
  const logsList = document.getElementById("logs-list");

  // GOD Mode toggle
  document.getElementById("btn-toggle-admin").onclick = () => {
    screenLogin.classList.add("hidden");
    screenGodDashboard.classList.remove("hidden");
  };

  function renderGodQueue() {
    godQueueList.innerHTML = "";
    locations.forEach((loc, index) => {
      const div = document.createElement("div");
      div.classList.add("user-box");
      div.innerHTML = `
        <strong>${loc.name}</strong><br>
        <span id="god-current-${index}">${loc.current}</span> / ${loc.capacity} people<br>
        <button onclick="increaseQueue(${index})">+1</button>
        <button onclick="decreaseQueue(${index})">-1</button>
        <button onclick="setMaxCapacity(${index})">Set Max</button>
      `;
      godQueueList.appendChild(div);
    });
  }

  function increaseQueue(index) {
    if (locations[index].current < locations[index].capacity) {
      locations[index].current++;
      logsData.push(`Admin increased queue at "${locations[index].name}"`);
      renderGodQueue();
      renderLocations(locationSearch.value);
      renderLogs();
    } else {
      alert("Max capacity reached!");
    }
  }

  function decreaseQueue(index) {
    if (locations[index].current > 0) {
      locations[index].current--;
      logsData.push(`Admin decreased queue at "${locations[index].name}"`);
      renderGodQueue();
      renderLocations(locationSearch.value);
      renderLogs();
    }
  }

  function setMaxCapacity(index) {
    const newCap = prompt("Enter max capacity:", locations[index].capacity);
    const capNum = parseInt(newCap);
    if (!isNaN(capNum) && capNum > 0) {
      locations[index].capacity = capNum;
      logsData.push(`Admin set max capacity of "${locations[index].name}" to ${capNum}`);
      renderGodQueue();
      renderLocations(locationSearch.value);
      renderLogs();
    } else {
      alert("Invalid number!");
    }
  }

  btnGodBack.onclick = () => {
    screenGodDashboard.classList.add("hidden");
    screenLogin.classList.remove("hidden");
  };

  btnCreateLocation.onclick = () => {
    const name = prompt("Enter location name:");
    const cap = parseInt(prompt("Enter max capacity:"));
    if (name && !isNaN(cap)) {
      locations.push({ name, capacity: cap, current: 0 });
      logsData.push(`Admin created location "${name}" with capacity ${cap}`);
      renderGodQueue();
      renderLocations(locationSearch.value);
      renderLogs();
    } else {
      alert("Invalid input!");
    }
  };

  btnViewLogs.onclick = () => {
    screenGodDashboard.classList.add("hidden");
    screenLogs.classList.remove("hidden");
  };

  document.getElementById("btn-logs-back").onclick = () => {
    screenLogs.classList.add("hidden");
    screenGodDashboard.classList.remove("hidden");
  };

  // Logs data
  let logsData = [];

  function renderLogs() {
    logsList.innerHTML = "";
    logsData.slice(-50).reverse().forEach(entry => {
      const div = document.createElement("div");
      div.classList.add("user-box");
      div.textContent = entry;
      logsList.appendChild(div);
    });
  }

  // Initial render
  renderGodQueue();
</script>

<style>
  #god-queue-list .user-box button {
    margin: 4px 4px 4px 0;
    padding: 6px 10px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 13px;
    background: var(--blue-main);
    color: white;
    transition: 0.2s;
  }
  #god-queue-list .user-box button:hover {
    background: var(--blue-glow);
  }
</style>
<!-- ================= PROFILE SETUP LOGIC ================= -->
<script>
  const screenSetup = document.getElementById("screen-setup");
  const btnSaveProfile = document.getElementById("btn-save-profile");
  const setupName = document.getElementById("setup-name");
  const setupAge = document.getElementById("setup-age");
  const setupGender = document.getElementById("setup-gender");

  // Show setup if user has no profile
  let currentUserProfile = null;

  function showProfileSetup() {
    screenLogin.classList.add("hidden");
    screenSetup.classList.remove("hidden");
  }

  btnSaveProfile.onclick = () => {
    const name = setupName.value.trim();
    const age = parseInt(setupAge.value);
    const gender = setupGender.value;

    if (!name) {
      alert("Name is required!");
      return;
    }
    if (isNaN(age) || age < 10 || age > 100) {
      alert("Please enter a valid age (10–100).");
      return;
    }
    if (!gender) {
      alert("Please select a gender.");
      return;
    }

    currentUserProfile = { name, age, gender };
    logsData.push(`Profile created: ${name}, ${age}, ${gender}`);

    // Save to Firebase (pseudo code for later integration)
    // db.collection("users").doc(auth.currentUser.uid).set(currentUserProfile);

    screenSetup.classList.add("hidden");
    screenLocations.classList.remove("hidden");
    renderLocations("");
  };

  // Animate transitions
  function fadeIn(el) {
    el.style.opacity = 0;
    el.classList.remove("hidden");
    let op = 0;
    const interval = setInterval(() => {
      op += 0.05;
      el.style.opacity = op;
      if (op >= 1) clearInterval(interval);
    }, 15);
  }

  function fadeOut(el) {
    let op = 1;
    const interval = setInterval(() => {
      op -= 0.05;
      el.style.opacity = op;
      if (op <= 0) {
        clearInterval(interval);
        el.classList.add("hidden");
      }
    }, 15);
  }

  // Replace all "classList.add/remove('hidden')" with fadeIn/fadeOut for smooth UI
  function switchScreen(from, to) {
    fadeOut(from);
    fadeIn(to);
  }
</script>

<style>
  /* Smooth fade transitions */
  .hidden {
    display: none !important;
    transition: opacity 0.3s ease;
  }
</style>
<!-- ================= LOCATION LIST LOGIC ================= -->
<script>
  const screenLocations = document.getElementById("screen-locations");
  const locationList = document.getElementById("location-list");
  const locationSearch = document.getElementById("location-search");
  const btnBackLocations = document.getElementById("btn-back-locations");

  // Sample locations for demo
  let locations = [
    { id: "loc1", name: "Main Lobby", count: 5 },
    { id: "loc2", name: "Cafeteria", count: 12 },
    { id: "loc3", name: "Gym Entrance", count: 3 },
    { id: "loc4", name: "Library", count: 8 }
  ];

  function renderLocations(filter = "") {
    locationList.innerHTML = "";
    const filtered = locations.filter(loc =>
      loc.name.toLowerCase().includes(filter.toLowerCase())
    );
    filtered.forEach(loc => {
      const div = document.createElement("div");
      div.classList.add("user-box");
      div.innerHTML = `
        <div style="font-weight: 600;">${loc.name}</div>
        <div>${loc.count} people waiting</div>
      `;
      div.onclick = () => openUserDashboard(loc);
      locationList.appendChild(div);
    });
  }

  locationSearch.addEventListener("input", () => {
    renderLocations(locationSearch.value);
  });

  function openUserDashboard(location) {
    currentLocation = location;
    document.getElementById("user-location-name").innerText = location.name;
    document.getElementById("user-current-count").innerText = location.count;
    switchScreen(screenLocations, screenUserDashboard);
  }

  btnBackLocations.onclick = () => {
    switchScreen(screenLocations, screenLogin); // Or setup depending on state
  };

  // USER DASHBOARD
  const screenUserDashboard = document.getElementById("screen-user-dashboard");
  const btnJoinQueue = document.getElementById("btn-join-queue");
  const btnLeaveQueue = document.getElementById("btn-leave-queue");
  const btnBackUser = document.getElementById("btn-back-locations");

  let currentLocation = null;

  btnJoinQueue.onclick = () => {
    if (!currentLocation) return;
    currentLocation.count++;
    document.getElementById("user-current-count").innerText = currentLocation.count;
    logsData.push(`${currentUserProfile.name} joined queue at ${currentLocation.name}`);
    // Firebase integration placeholder
    // db.collection("locations").doc(currentLocation.id).update({ count: currentLocation.count });
  };

  btnLeaveQueue.onclick = () => {
    if (!currentLocation || currentLocation.count <= 0) return;
    currentLocation.count--;
    document.getElementById("user-current-count").innerText = currentLocation.count;
    logsData.push(`${currentUserProfile.name} left queue at ${currentLocation.name}`);
    // Firebase update placeholder
  };

  btnBackUser.onclick = () => {
    switchScreen(screenUserDashboard, screenLocations);
  };
</script>
<!-- ================= GOD DASHBOARD LOGIC ================= -->
<script>
  const screenGodDashboard = document.getElementById("screen-god-dashboard");
  const godQueueList = document.getElementById("god-queue-list");
  const btnCreateLocation = document.getElementById("btn-create-location");
  const btnViewLogs = document.getElementById("btn-view-logs");
  const btnGodBack = document.getElementById("btn-god-back");

  let godLocations = [...locations]; // copy of locations for admin

  function renderGodQueue() {
    godQueueList.innerHTML = "";
    godLocations.forEach(loc => {
      const div = document.createElement("div");
      div.classList.add("user-box");
      div.innerHTML = `
        <div style="font-weight: 600;">${loc.name}</div>
        <div>${loc.count} people waiting</div>
        <div style="margin-top: 8px;">
          <button class="ghost" onclick="adjustQueue('${loc.id}', 1)">+1</button>
          <button class="ghost" onclick="adjustQueue('${loc.id}', -1)">-1</button>
        </div>
      `;
      godQueueList.appendChild(div);
    });
  }

  function adjustQueue(id, change) {
    const loc = godLocations.find(l => l.id === id);
    if (!loc) return;
    loc.count = Math.max(0, loc.count + change);
    renderGodQueue();
    logsData.push(`Admin adjusted queue at ${loc.name} by ${change}`);
    // Firebase update placeholder
    // db.collection("locations").doc(id).update({ count: loc.count });
  }

  btnCreateLocation.onclick = () => {
    const name = prompt("Enter location name:");
    if (!name) return alert("Name required!");
    const newLoc = { id: `loc${Date.now()}`, name, count: 0 };
    godLocations.push(newLoc);
    locations.push(newLoc); // also add for user view
    renderGodQueue();
  };

  btnViewLogs.onclick = () => {
    switchScreen(screenGodDashboard, screenLogs);
    renderLogs();
  };

  btnGodBack.onclick = () => {
    switchScreen(screenGodDashboard, screenLogin); // or setup depending on state
  };
</script>
<!-- ================= LOGS VIEW LOGIC ================= -->
<script>
  const screenLogs = document.getElementById("screen-logs");
  const logsList = document.getElementById("logs-list");
  const btnLogsBack = document.getElementById("btn-logs-back");

  let logsData = []; // Store actions: user join/leave, admin adjustments

  function renderLogs() {
    logsList.innerHTML = "";
    if (logsData.length === 0) {
      logsList.innerHTML = "<p class='subtitle center'>No activity yet</p>";
      return;
    }

    logsData.slice().reverse().forEach((log, index) => {
      const div = document.createElement("div");
      div.classList.add("user-box");
      div.style.fontSize = "13px";
      div.style.marginBottom = "6px";
      div.innerText = `${index + 1}. ${log}`;
      logsList.appendChild(div);
    });
  }

  btnLogsBack.onclick = () => {
    switchScreen(screenLogs, screenGodDashboard);
  };

  // Example function to track user joining/leaving queue
  function logUserAction(userName, locName, action) {
    logsData.push(`${userName} ${action} queue at ${locName}`);
    renderLogs();
  }
</script>
<script>
  // DOM Elements
  const screenUserDashboard = document.getElementById("screen-user-dashboard");
  const userCurrentCount = document.getElementById("user-current-count");
  const btnJoinQueue = document.getElementById("btn-join-queue");
  const btnLeaveQueue = document.getElementById("btn-leave-queue");
  const btnBackLocations = document.getElementById("btn-back-locations");

  const screenGodDashboard = document.getElementById("screen-god-dashboard");
  const godQueueList = document.getElementById("god-queue-list");
  const btnCreateLocation = document.getElementById("btn-create-location");

  // Fake DB for demonstration (replace with Firestore)
  let locations = [
    { name: "Main Lobby", count: 0, maxCapacity: 20 },
    { name: "Cafeteria", count: 0, maxCapacity: 15 },
  ];

  let currentUser = { name: "John Doe", location: null };

  // Switch to a screen utility
  function switchScreen(hideScreen, showScreen) {
    hideScreen.classList.add("hidden");
    showScreen.classList.remove("hidden");
  }

  // ================= USER QUEUE FUNCTIONS =================
  function updateUserQueueUI() {
    if (!currentUser.location) return;
    const loc = locations.find(l => l.name === currentUser.location);
    userCurrentCount.innerText = loc.count;
  }

  btnJoinQueue.onclick = () => {
    const loc = locations.find(l => l.name === currentUser.location);
    if (loc.count < loc.maxCapacity) {
      loc.count++;
      logUserAction(currentUser.name, loc.name, "joined");
      updateUserQueueUI();
      renderGodQueue();
    } else {
      alert("Queue full!");
    }
  };

  btnLeaveQueue.onclick = () => {
    const loc = locations.find(l => l.name === currentUser.location);
    if (loc.count > 0) {
      loc.count--;
      logUserAction(currentUser.name, loc.name, "left");
      updateUserQueueUI();
      renderGodQueue();
    }
  };

  btnBackLocations.onclick = () => {
    switchScreen(screenUserDashboard, document.getElementById("screen-locations"));
  };

  // ================= GOD DASHBOARD FUNCTIONS =================
  function renderGodQueue() {
    godQueueList.innerHTML = "";
    locations.forEach(loc => {
      const div = document.createElement("div");
      div.classList.add("user-box");
      div.style.display = "flex";
      div.style.justifyContent = "space-between";
      div.style.alignItems = "center";

      div.innerHTML = `
        <span>${loc.name} (${loc.count}/${loc.maxCapacity})</span>
        <button class="ghost" onclick="adjustQueue('${loc.name}', 1)">+1</button>
        <button class="ghost" onclick="adjustQueue('${loc.name}', -1)">-1</button>
      `;
      godQueueList.appendChild(div);
    });
  }

  function adjustQueue(locName, delta) {
    const loc = locations.find(l => l.name === locName);
    loc.count = Math.max(0, Math.min(loc.maxCapacity, loc.count + delta));
    logUserAction("Admin", loc.name, delta > 0 ? "added people" : "removed people");
    renderGodQueue();
    if (currentUser.location === loc.name) updateUserQueueUI();
  }

  btnCreateLocation.onclick = () => {
    const newLoc = prompt("Enter location name:");
    if (!newLoc) return;
    locations.push({ name: newLoc, count: 0, maxCapacity: 10 });
    renderGodQueue();
    alert(`Location "${newLoc}" created`);
  };

  // Initial render
  renderGodQueue();
</script>

<script type="module">
  import { auth, provider } from './js/firebase.js';
  import { signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  // DOM Elements
  const btnGoogleLogin = document.getElementById("btn-google-login");
  const screenLogin = document.getElementById("screen-login");
  const screenSetup = document.getElementById("screen-setup");
  const btnSaveProfile = document.getElementById("btn-save-profile");
  const setupName = document.getElementById("setup-name");
  const setupAge = document.getElementById("setup-age");
  const setupGender = document.getElementById("setup-gender");
  const screenLocations = document.getElementById("screen-locations");
  const locationList = document.getElementById("location-list");
  const locationSearch = document.getElementById("location-search");

  // Google Login
  btnGoogleLogin.onclick = async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      currentUser.name = result.user.displayName || "User";
      currentUser.email = result.user.email;
      // Check if first-time user
      if (!localStorage.getItem("profileSet")) {
        switchScreen(screenLogin, screenSetup);
      } else {
        switchScreen(screenLogin, screenLocations);
        renderLocationList();
      }
    } catch (err) {
      console.error(err);
      alert("Login failed!");
    }
  };

  // Save Profile
  btnSaveProfile.onclick = () => {
    if (!setupName.value || !setupAge.value || !setupGender.value) {
      alert("Fill all fields");
      return;
    }
    currentUser.name = setupName.value;
    currentUser.age = setupAge.value;
    currentUser.gender = setupGender.value;
    localStorage.setItem("profileSet", "true");
    switchScreen(screenSetup, screenLocations);
    renderLocationList();
  };

  // Render Location List
  function renderLocationList() {
    locationList.innerHTML = "";
    locations.forEach(loc => {
      const div = document.createElement("div");
      div.classList.add("user-box");
      div.innerHTML = `
        <span>${loc.name} (${loc.count}/${loc.maxCapacity})</span>
        <button onclick="joinLocation('${loc.name}')">Enter</button>
      `;
      locationList.appendChild(div);
    });
  }

  // Location search filter
  locationSearch.oninput = () => {
    const filter = locationSearch.value.toLowerCase();
    Array.from(locationList.children).forEach(div => {
      const text = div.textContent.toLowerCase();
      div.style.display = text.includes(filter) ? "flex" : "none";
    });
  };

  // Join a location
  window.joinLocation = (locName) => {
    currentUser.location = locName;
    switchScreen(screenLocations, screenUserDashboard);
    updateUserQueueUI();
  };

  // Firebase Auth State Listener
  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser.email = user.email;
      currentUser.name = user.displayName;
      if (localStorage.getItem("profileSet")) {
        switchScreen(screenLogin, screenLocations);
        renderLocationList();
      } else {
        switchScreen(screenLogin, screenSetup);
      }
    } else {
      switchScreen(screenLocations, screenLogin);
    }
  });
</script>
<script type="module">
  import { db } from './js/firebase.js';
  import { doc, getDoc, setDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const screenUserDashboard = document.getElementById("screen-user-dashboard");
  const btnJoinQueue = document.getElementById("btn-join-queue");
  const btnLeaveQueue = document.getElementById("btn-leave-queue");
  const userCurrentCount = document.getElementById("user-current-count");
  const btnBackLocations = document.getElementById("btn-back-locations");
  const btnLogout = document.getElementById("btn-logout");

  // Dummy Data
  const locations = [
    { name: "Lobby A", count: 0, maxCapacity: 20 },
    { name: "Lobby B", count: 0, maxCapacity: 15 },
    { name: "Lobby C", count: 0, maxCapacity: 10 }
  ];

  const currentUser = {};

  // Switch screen helper
  function switchScreen(hide, show) {
    hide.classList.add("hidden");
    show.classList.remove("hidden");
  }

  // User joins queue
  btnJoinQueue.onclick = () => {
    const loc = locations.find(l => l.name === currentUser.location);
    if (loc.count >= loc.maxCapacity) {
      alert("Queue full!");
      return;
    }
    loc.count++;
    updateUserQueueUI();
    logAction(`${currentUser.name} joined ${loc.name}`);
  };

  // User leaves queue
  btnLeaveQueue.onclick = () => {
    const loc = locations.find(l => l.name === currentUser.location);
    if (loc.count > 0) loc.count--;
    updateUserQueueUI();
    logAction(`${currentUser.name} left ${loc.name}`);
  };

  function updateUserQueueUI() {
    const loc = locations.find(l => l.name === currentUser.location);
    userCurrentCount.textContent = loc.count;
  }

  // Back button
  btnBackLocations.onclick = () => {
    switchScreen(screenUserDashboard, screenLocations);
  };

  // Logout
  btnLogout.onclick = () => {
    auth.signOut();
    switchScreen(screenUserDashboard, screenLogin);
    localStorage.removeItem("profileSet");
  };

  // Logs
  const logs = [];
  function logAction(text) {
    const timestamp = new Date().toLocaleTimeString();
    logs.push(`${timestamp}: ${text}`);
    if (document.getElementById("logs-list")) {
      document.getElementById("logs-list").innerHTML = logs.map(l => `<div class="user-box">${l}</div>`).join("");
    }
  }

  // God/Admin Mode
  const screenGodDashboard = document.getElementById("screen-god-dashboard");
  const btnToggleAdmin = document.getElementById("btn-toggle-admin");
  const godQueueList = document.getElementById("god-queue-list");
  const btnGodBack = document.getElementById("btn-god-back");

  btnToggleAdmin.onclick = () => {
    switchScreen(screenLogin, screenGodDashboard);
    renderGodQueues();
  };

  function renderGodQueues() {
    godQueueList.innerHTML = "";
    locations.forEach(loc => {
      const div = document.createElement("div");
      div.classList.add("user-box");
      div.innerHTML = `<strong>${loc.name}</strong>: ${loc.count}/${loc.maxCapacity}`;
      godQueueList.appendChild(div);
    });
  }

  btnGodBack.onclick = () => {
    switchScreen(screenGodDashboard, screenLogin);
  };

  // Initial render
  renderLocationList();
</script>
